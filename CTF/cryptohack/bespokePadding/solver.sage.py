

# This file was *autogenerated* from the file solver.sage
from sage.all_cmdline import *   # import sage library

_sage_const_1 = Integer(1); _sage_const_2 = Integer(2); _sage_const_0 = Integer(0); _sage_const_11 = Integer(11)
from sage.all import *
from Crypto.Util.number import *
from pwn import *
import json

NC = "nc socket.cryptohack.org 13386".split()
HOST = NC[_sage_const_1 ]
PORT = NC[_sage_const_2 ]

def gcd(a, b): 
    while b:
        a, b = b, a % b
    return a.monic()

def franklinreiter(C1, C2, e, N, a1, b1,a2,b2):
    P = PolynomialRing(Zmod(N), names=('X',)); (X,) = P._first_ngens(1)
    g1 = (a1*X + b1)**e - C1
    g2 = (a2*X + b2)**e - C2
    result = -gcd(g1, g2).coefficients()[_sage_const_0 ]
    return result

r = remote(HOST,PORT)

payload = dict()
payload["option"] = "get_flag"
payload = json.dumps(payload).encode()

r.sendline(payload)

r.recvuntil(b"flag.\n")

result = json.loads(r.recvline(_sage_const_0 ).decode())

n = result["modulus"]

a1, b1 = result["padding"][_sage_const_0 ],result["padding"][_sage_const_1 ]

c1 = result["encrypted_flag"]

payload = dict()
payload["option"] = "get_flag"
payload = json.dumps(payload).encode()

r.sendline(payload)


result = json.loads(r.recvline(_sage_const_0 ).decode())

print("selesai")

a2, b2 = result["padding"][_sage_const_0 ],result["padding"][_sage_const_1 ]
c2 = result["encrypted_flag"]

m = franklinreiter(c2,c1,_sage_const_11 ,n,a2,b2,a1,b1)

print(bytes.fromhex(hex(m)[_sage_const_2 :]))

r.interactive()

